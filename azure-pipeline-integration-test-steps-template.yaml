# File: azure-pipeline-integration-test-steps-template.yaml
parameters:
  platform: ''  
  
steps:
- task: qetza.replacetokens.replacetokens-task.replacetokens@3
  displayName: 'Configure test in **/test/LoRaWan.IntegrationTest/appsettings.json'  
  inputs:
    targetFiles: '**/test/LoRaWan.IntegrationTest/appsettings.json'

# Runs Integration testing only if no additional integration test arguments were passed
- task: DotNetCoreCLI@2
  displayName: Build IntegrationTest
  inputs:
    command: build
    projects: '**/test/LoRaWan.IntegrationTest/LoRaWan.IntegrationTest.csproj'
    arguments: '--configuration $(BuildConfiguration)'

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: OTAAJoinTest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: ABPTest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: C2DMessageTest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: OTAATest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: MacTest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: SensorDecodingTest

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: MultiGatewayTests

- template: azure-pipeline-single-integration-test-template.yaml
  parameters:
    testName: ClassCTest


# Run integration test with filters only, no built-in retries
- task: DotNetCoreCLI@2
  displayName: 'Run integration test with additional arguments (no retry)'
  condition: ne(variables['AdditionalIntegrationTestArguments'], '')
  inputs:
    command: test
    projects: '**/test/LoRaWan.IntegrationTest/LoRaWan.IntegrationTest.csproj'
    arguments: '--configuration $(BuildConfiguration) -p:ParallelizeTestCollections=false $(AdditionalIntegrationTestArguments)'
